#!/usr/bin/env bash
# Basic start script for running the launcher with the libs packaged with it.

function printerror {
    printf "$1"
    if which zenity >/dev/null; then zenity --error --text="$1" &>/dev/null;
    elif which kdialog >/dev/null; then kdialog --error "$1" &>/dev/null;
    fi
}

if [[ $EUID -eq 0 ]]; then
    printerror "This program should not be run using sudo or as the root user!\n"
    exit 1
fi


LAUNCHER_NAME=@Launcher_APP_BINARY_NAME@
LAUNCHER_DIR="$(dirname "$(readlink -f "$0")")"
echo "Launcher Dir: ${LAUNCHER_DIR}"

# Makes the launcher use portals for file picking
export QT_QPA_PLATFORMTHEME=xdgdesktopportal

# Just to be sure...
chmod +x "${LAUNCHER_DIR}/bin/${LAUNCHER_NAME}"

ARGS=("${LAUNCHER_DIR}/${LAUNCHER_NAME}" "${LAUNCHER_DIR}/bin/${LAUNCHER_NAME}")

if [ -f portable.txt ]; then
    ARGS+=("-d" "${LAUNCHER_DIR}")
fi

ARGS+=("$@")

# Run the launcher
exec -a "${ARGS[@]}"
